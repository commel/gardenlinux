#!/usr/bin/env bash

set -eufo pipefail

locations=(
	/etc/cdi
	/etc/cni
	/etc/containerd
	/etc/hostname
	/etc/hosts
	/etc/modules
	/etc/pki
	/etc/sudoers.d
	/etc/sysctl.d
	/etc/systemd
	/home/gardener
	/opt
)

for location in "${locations[@]}"; do
	[ -e "$location" ] || continue

	if [ -e "/var$location" ]; then
		echo "/var$location already exists!" >&2
		exit 1
	fi

	mkdir -p "/var$(dirname "$location")"
	cp -axT "$location" "/var$location"
	mount --bind "/var$location" "$location"
done
