#!/usr/bin/env bash

set -eufo pipefail

systemctl mask systemd-bless-boot.service
systemctl enable var.mount
systemctl enable setup-writable.service

for type in rsa ecdsa ed25519; do
	ln -s /var/lib/ssh/ssh_host_${type}_key /etc/ssh/ssh_host_${type}_key
	ln -s /var/lib/ssh/ssh_host_${type}_key.pub /etc/ssh/ssh_host_${type}_key.pub
done

update-kernel-cmdline

mkdir -p /efi

[ ! -L /etc/default/locale ] || rm /etc/default/locale
ln -s ../locale.conf /etc/default/locale

# Test for the systemd-pcrphase in case dracut changes it mind. #2108
[ -e /usr/lib/systemd/systemd-pcrphase ] || ln -s systemd-pcrextend /usr/lib/systemd/systemd-pcrphase
